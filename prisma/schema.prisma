generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id       Int        @id @default(autoincrement())
  email    String     @unique
  password String
  role     String     @default("VIEWER")
  logs     AuditLog[]
}

model InventoryItem {
  id           Int           @id @default(autoincrement())
  name         String
  sku          String        @unique
  quantity     Int           @default(0)
  price        Float         @default(0.0)
  category     String
  supplierId   Int?
  version      Int           @default(1)
  deletedAt    DateTime?
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  supplier     Supplier?     @relation(fields: [supplierId], references: [id])
  transactions Transaction[]
}

model Transaction {
  id     Int           @id @default(autoincrement())
  type   String
  amount Int
  date   DateTime      @default(now())
  itemId Int
  item   InventoryItem @relation(fields: [itemId], references: [id])
}

model Supplier {
  id             Int             @id @default(autoincrement())
  name           String
  contact        String?
  email          String?
  createdAt      DateTime        @default(now())
  address        String?
  taxId          String?
  deletedAt      DateTime?
  items          InventoryItem[]
  purchaseOrders PurchaseOrder[]
  files          SupplierFile[]
}

model SupplierFile {
  id         Int      @id @default(autoincrement())
  name       String
  path       String
  supplierId Int
  createdAt  DateTime @default(now())
  supplier   Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
}

model Customer {
  id            Int            @id @default(autoincrement())
  firstName     String?
  lastName      String?
  email         String?
  phone         String?
  address       String?
  loyaltyPoints Int            @default(0)
  accountNumber String?        @unique
  createdAt     DateTime       @default(now())
  deletedAt     DateTime?
  files         CustomerFile[]
  deals         Deal[]
  invoices      Invoice[]
  projects      Project[]
}

model Deal {
  id         Int        @id @default(autoincrement())
  title      String
  value      Float
  status     String     @default("LEAD")
  customerId Int
  createdAt  DateTime   @default(now())
  updatedAt  DateTime   @updatedAt
  customer   Customer   @relation(fields: [customerId], references: [id], onDelete: Cascade)
  files      DealFile[]
}

model DealFile {
  id        Int      @id @default(autoincrement())
  name      String
  path      String
  dealId    Int
  createdAt DateTime @default(now())
  deal      Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
}

model PurchaseOrder {
  id          Int      @id @default(autoincrement())
  orderNumber String   @unique
  status      String   @default("DRAFT")
  total       Float    @default(0)
  supplierId  Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  supplier    Supplier @relation(fields: [supplierId], references: [id])
}

model CustomerFile {
  id         Int      @id @default(autoincrement())
  name       String
  path       String
  customerId Int
  createdAt  DateTime @default(now())
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
}

model Project {
  id          Int           @id @default(autoincrement())
  name        String
  description String?
  color       String        @default("#3b82f6")
  customerId  Int?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?
  customer    Customer?     @relation(fields: [customerId], references: [id])
  files       ProjectFile[]
  tasks       Task[]
}

model ProjectFile {
  id        Int      @id @default(autoincrement())
  name      String
  path      String
  projectId Int
  createdAt DateTime @default(now())
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Task {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  status      String    @default("TODO")
  priority    String    @default("MEDIUM")
  dueDate     DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  deletedAt   DateTime?
  projectId   Int
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
}

model Invoice {
  id          Int      @id @default(autoincrement())
  number      String   @unique
  total       Float
  status      String   @default("UNPAID") // PAID, UNPAID, CANCELLED
  customerId  Int
  customer    Customer @relation(fields: [customerId], references: [id])
  dueDate     DateTime
  deletedAt   DateTime?
  createdAt   DateTime @default(now())
}

model Expense {
  id          Int           @id @default(autoincrement())
  category    String        // RENT, SALARIES, UTILITIES, MARKETING, OTHER
  amount      Float
  description String?
  date        DateTime      @default(now())
  files       ExpenseFile[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  deletedAt   DateTime?
}

model ExpenseFile {
  id        Int      @id @default(autoincrement())
  name      String
  path      String
  expenseId Int
  expense   Expense  @relation(fields: [expenseId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model FinancialSnapshot {
  id        Int      @id @default(autoincrement())
  month     DateTime // First day of the month
  revenue   Float    @default(0)
  expenses  Float    @default(0)
  netProfit Float    @default(0)
  updatedAt DateTime @updatedAt
  
  @@unique([month])
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  details   String?
  userId    Int?
  timestamp DateTime @default(now())
  user      User?    @relation(fields: [userId], references: [id])
}
