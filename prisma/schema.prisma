generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "sqlite"
  url      = "file:./dev.db"
}

model User {
  id        Int        @id @default(autoincrement())
  email     String     @unique
  password  String
  role      String     @default("VIEWER") // ADMIN, EDITOR, VIEWER
  logs      AuditLog[]
}

model InventoryItem {
  id           Int           @id @default(autoincrement())
  name         String
  sku          String        @unique
  quantity     Int           @default(0)
  price        Float         @default(0.0)
  category     String
  supplierId   Int?
  supplier     Supplier?     @relation(fields: [supplierId], references: [id])
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  transactions Transaction[]
}

model Transaction {
  id        Int           @id @default(autoincrement())
  type      String        // "IN" or "OUT"
  amount    Int
  date      DateTime      @default(now())
  itemId    Int
  item      InventoryItem @relation(fields: [itemId], references: [id])
}

model Supplier {
  id             Int             @id @default(autoincrement())
  name           String
  contact        String?
  email          String?
  address        String?
  taxId          String?
  items          InventoryItem[]
  files          SupplierFile[]
  purchaseOrders PurchaseOrder[]
  createdAt      DateTime        @default(now())
}

model SupplierFile {
  id         Int      @id @default(autoincrement())
  name       String
  path       String
  supplierId Int
  supplier   Supplier @relation(fields: [supplierId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model Customer {
  id              Int            @id @default(autoincrement())
  firstName       String?
  lastName        String?
  email           String?
  phone           String?
  address         String?
  loyaltyPoints   Int            @default(0)
  accountNumber   String?        @unique
  projects        Project[]
  invoices        Invoice[]
  deals           Deal[]
  files           CustomerFile[]
  createdAt       DateTime       @default(now())
}

model Deal {
  id          Int      @id @default(autoincrement())
  title       String
  value       Float
  status      String   @default("LEAD") // LEAD, PROPOSAL, NEGOTIATION, CLOSED_WON, CLOSED_LOST
  customerId  Int
  customer    Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  files       DealFile[]
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model DealFile {
  id        Int      @id @default(autoincrement())
  name      String
  path      String
  dealId    Int
  deal      Deal     @relation(fields: [dealId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model PurchaseOrder {
  id          Int      @id @default(autoincrement())
  orderNumber String   @unique
  status      String   @default("DRAFT") // DRAFT, SENT, RECEIVED, CANCELLED
  total       Float    @default(0)
  supplierId  Int
  supplier    Supplier @relation(fields: [supplierId], references: [id])
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model CustomerFile {
  id         Int      @id @default(autoincrement())
  name       String
  path       String
  customerId Int
  customer   Customer @relation(fields: [customerId], references: [id], onDelete: Cascade)
  createdAt  DateTime @default(now())
}

model Project {
  id          Int           @id @default(autoincrement())
  name        String
  description String?
  color       String        @default("#3b82f6")
  customerId  Int?
  customer    Customer?     @relation(fields: [customerId], references: [id])
  tasks       Task[]
  files       ProjectFile[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
}

model ProjectFile {
  id        Int      @id @default(autoincrement())
  name      String
  path      String
  projectId Int
  project   Project  @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
}

model Task {
  id          Int       @id @default(autoincrement())
  title       String
  description String?
  status      String    @default("TODO")
  priority    String    @default("MEDIUM")
  dueDate     DateTime?
  projectId   Int
  project     Project   @relation(fields: [projectId], references: [id], onDelete: Cascade)
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
}

model Invoice {
  id          Int      @id @default(autoincrement())
  number      String   @unique
  total       Float
  status      String   @default("UNPAID") // PAID, UNPAID, CANCELLED
  customerId  Int
  customer    Customer @relation(fields: [customerId], references: [id])
  dueDate     DateTime
  createdAt   DateTime @default(now())
}

model AuditLog {
  id        Int      @id @default(autoincrement())
  action    String
  details   String?
  userId    Int?
  user      User?    @relation(fields: [userId], references: [id])
  timestamp DateTime @default(now())
}
